# `waterSpec` New Workflow: Class-Based Analysis

This document demonstrates the new, recommended workflow for using the `waterSpec` package. The introduction of the `Analysis` class provides a more organized, efficient, and user-friendly way to perform spectral analysis.

## The `Analysis` Class

The new workflow is centered around the `waterSpec.Analysis` object. You initialize this object with your dataset, and it handles all the data loading and preprocessing internally. You can then run a complete analysis with a single command.

### Step 1: Initialize the Analysis

First, import the `Analysis` class and create an instance. You only need to provide your file path and column names once.

```python
from waterSpec import Analysis
import os

# Define the path to your data file
file_path = 'examples/sample_data.csv'

# Create the analyzer object
# This loads and preprocesses the data immediately.
analyzer = Analysis(
    file_path=file_path,
    time_col='timestamp',
    data_col='concentration'
)

print("Analysis object created and data preprocessed.")
```

### Step 2: Run the Full Analysis

Now, simply call the `run_full_analysis()` method. You just need to tell it where to save the outputs.

This single command will:
1.  Run the automated analysis to find the best-fitting model (standard or segmented).
2.  Calculate significant periodicities using the False Alarm Probability (FAP).
3.  Generate and save a publication-quality plot of the power spectrum.
4.  Generate and save a detailed text summary of the results.

```python
# Define an output directory
output_dir = 'analysis_results'

# Run the entire workflow
results_dict = analyzer.run_full_analysis(output_dir=output_dir)

# The results are also stored in the object
# print(analyzer.results)
```

### Step 3: Review the Outputs

After the command finishes, your specified output directory (`analysis_results/` in this case) will contain the following files:

**1. `concentration_spectrum_plot.png`**

A plot showing the log-log power spectrum, the best-fit line(s), the estimated spectral exponent (Î²), and any significant peaks.

*(This would be an image of the plot generated by the package)*

**2. `concentration_summary.txt`**

A text file containing a comprehensive, human-readable interpretation of the analysis.

---

**Example `summary.txt` content:**

```
Automatic Analysis for: concentration
-----------------------------------
Model Comparison (Lower BIC is better):
  - Standard Fit:   BIC = -287.41 (Î² = 0.58)
  - Segmented Fit:  BIC = N/A ()
==> Chosen Model: Standard
-----------------------------------

Details for Chosen (Standard) Model:
Standard Analysis for: concentration
Value: Î² = 0.58 (95% CI: 0.44â€“0.72)
Persistence Level: ðŸŸ¡ Mixed / Weak Persistence
Scientific Meaning: -0.5 < Î² < 1 (fGn-like): Weak persistence or anti-persistence, suggesting event-driven transport.
Contextual Comparison: Closest to TSS (Surface runoff-dominated).

-----------------------------------
Significant Periodicities Found:
  - Period: 1.0 years (FAP: 1.23E-04)
  - Period: 6.0 months (FAP: 2.50E-02)
```
---

This new workflow simplifies the process of running a full analysis down to just two main steps while providing a more organized structure for advanced use.
