# Validation: Haar Percentile Analysis

This document reports the validation results for the new Haar Percentile Analysis features. The validation ensures that the new `statistic="percentile"` argument correctly calculates fluctuations and maintains expected scaling properties for known signals.

## Validation Methodology

The validation script (`validation/validate_haar_percentiles.py`) performs two tests:

1.  **Micro Validation (Exactness):**
    *   Uses a small, synthetic dataset: `[1, 2, ..., 20]`.
    *   Calculates the Haar fluctuation for a single window of size 10 (splitting at $t=5$).
    *   Manually computes the 90th percentile of the left (`[1..5]`) and right (`[6..10]`) halves using the Hazen plotting position method.
    *   Compares the manual result with the output of `calculate_haar_fluctuations`.

2.  **Macro Validation (Scaling Consistency):**
    *   Generates 10,000 points of Gaussian White Noise.
    *   Calculates the spectral slope $\beta$ using the standard mean-based Haar analysis.
    *   Calculates the spectral slope $\beta$ using the 90th percentile Haar analysis.
    *   **Theory:** For a Gaussian process (monofractal), all moments scale similarly. Therefore, the spectral slopes for the mean and the 90th percentile should be approximately equal ($\beta \approx 0$).
    *   Checks if the difference between slopes is within a tolerance of 0.2.

## Validation Results

The following output was generated by running the validation script:

```text

--- Micro Validation (Small Dataset) ---
Left Data: [1 2 3 4 5]
Right Data: [ 6  7  8  9 10]
Manual 90th Left: 5.0
Manual 90th Right: 10.0
Expected Fluctuation: 5.0
Code Calculated Fluctuation: 5.0
✅ Micro validation PASSED.

--- Macro Validation (Gaussian White Noise) ---
Beta (Mean): 0.021 (Expected ~0 for White Noise)
Beta (90th): 0.093
Difference: 0.072
✅ Macro validation PASSED (Scaling is consistent).

```

## Conclusion

The implementation of Haar Percentiles correctly computes the requested statistic and produces scientifically valid results for standard reference signals.
